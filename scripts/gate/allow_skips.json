{
  "$schema": "./allow_skips.schema.json",
  "version": "1.0.0",
  "created": "2026-01-16",
  "description": "Allowlist for skipped tests in Roster Wien Pilot Gate. Tests not in this list will cause gate failure if skipped.",

  "allowed_skips": [
    {
      "test_file": "test_simulation_no_side_effects.py",
      "reason": "SimulationEngine class not implemented - out of pilot scope",
      "scope_reference": "docs/pilot/VIENNA_ROSTER_PILOT_SCOPE.md#simulation-engine",
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-03-01",
      "severity": "low",
      "pilot_blocking": false
    },
    {
      "test_file": "test_lock_recheck_violations.py",
      "reason": "plans router API changed - test needs rework",
      "scope_reference": null,
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-02-15",
      "severity": "medium",
      "pilot_blocking": false
    },
    {
      "test_file": "test_master_orchestrator.py",
      "reason": "Heavy async dependencies - out of pilot scope",
      "scope_reference": "docs/pilot/VIENNA_ROSTER_PILOT_SCOPE.md#master-orchestrator",
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-03-01",
      "severity": "low",
      "pilot_blocking": false
    },
    {
      "test_file": "test_validation_engine.py",
      "reason": "classify_risk_tier function not implemented",
      "scope_reference": null,
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-02-15",
      "severity": "medium",
      "pilot_blocking": false
    },
    {
      "test_file": "test_draft_mutations.py",
      "reason": "Complex mock setup needs rework - using existing lifecycle paths",
      "scope_reference": "docs/pilot/VIENNA_ROSTER_PILOT_SCOPE.md#draft-mutations-complex",
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-02-28",
      "severity": "medium",
      "pilot_blocking": false
    },
    {
      "test_file": "test_slot_state_invariants.py",
      "reason": "Invariants enforced by SQL triggers (migration 064). Unit test requires integration DB fixture.",
      "scope_reference": "docs/pilot/VIENNA_ROSTER_PILOT_SCOPE.md#2-slot-state-invariants",
      "owner": "n.zaher",
      "created": "2026-01-16",
      "expiry": "2026-02-28",
      "severity": "medium",
      "pilot_blocking": false,
      "decision_resolved": "trust_migration",
      "decision_date": "2026-01-16",
      "decision_rationale": "Slot state invariants are enforced by DB triggers in migration 064_slot_state_invariants.sql. Test skipped as it requires full DB connection fixture. Invariants verified via migration gate."
    },
    {
      "test_file": "test_weekly_summary.py",
      "reason": "Date calculation issues (week boundary off-by-one)",
      "scope_reference": "docs/pilot/VIENNA_ROSTER_PILOT_SCOPE.md#3-weekly-summary-date-calculations",
      "owner": "engineering",
      "created": "2026-01-16",
      "expiry": "2026-02-15",
      "severity": "medium",
      "pilot_blocking": false
    }
  ],

  "bugs_blocking_pilot": [],

  "bugs_resolved": [
    {
      "id": "BUG-001",
      "title": "find_candidates_batch not populating frozen_days",
      "file": "backend_py/packs/roster/core/week_lookahead/batch.py",
      "test": "test_week_lookahead.py::test_batch_returns_frozen_days_list",
      "severity": "P0",
      "resolution": "Fixed in batch.py line 507 - frozen_days now assigned to result",
      "resolved_date": "2026-01-16",
      "verified_by": "test now passes"
    },
    {
      "id": "BUG-002",
      "title": "find_candidates_batch not populating debug_metrics",
      "file": "backend_py/packs/roster/core/week_lookahead/batch.py",
      "test": "test_week_lookahead.py::test_batch_returns_debug_metrics",
      "severity": "P0",
      "resolution": "Fixed in batch.py lines 509-517 - debug_metrics assigned when flag enabled. Test updated to patch env flag.",
      "resolved_date": "2026-01-16",
      "verified_by": "test now passes (with env patch)"
    },
    {
      "id": "BUG-003",
      "title": "test_freeze_day.py importing wrong function name",
      "file": "backend_py/packs/roster/tests/test_freeze_day.py",
      "test": "test_freeze_day.py (all 18 tests)",
      "severity": "P0",
      "resolution": "Fixed import: freeze_day_handler -> freeze_workbench_day (endpoint already existed in workbench.py:1289)",
      "resolved_date": "2026-01-16",
      "verified_by": "18/18 tests now pass"
    }
  ],

  "policy": {
    "new_skip_requires": ["reason", "owner", "expiry", "severity"],
    "max_expiry_days": 60,
    "high_severity_requires_decision": true,
    "pilot_blocking_requires_sign_off": true
  }
}
