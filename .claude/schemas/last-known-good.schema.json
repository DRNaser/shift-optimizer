{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://solvereign.com/schemas/last-known-good.json",
  "version": "1.0.0",
  "title": "Last Known Good State Schema",
  "description": "Schema for tracking last known good deployment state",
  "type": "object",
  "required": ["git_sha", "migrations_version", "config_hash", "timestamp"],
  "additionalProperties": false,
  "properties": {
    "git_sha": {
      "type": "string",
      "pattern": "^[a-f0-9]{7,40}$",
      "description": "Git commit SHA (short or full)"
    },
    "migrations_version": {
      "type": "string",
      "pattern": "^[0-9]{3}_[a-z_]+$",
      "description": "Last applied migration in format NNN_description"
    },
    "config_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA256 hash of configuration with prefix"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last successful deployment"
    },
    "all_tests_pass": {
      "type": "boolean",
      "description": "Whether all tests passed at this state"
    },
    "health_status": {
      "type": "string",
      "enum": ["healthy", "degraded", "unhealthy"],
      "description": "Health status at time of recording"
    },
    "deployed_by": {
      "type": ["string", "null"],
      "description": "User or system that performed deployment"
    },
    "deployment_notes": {
      "type": ["string", "null"],
      "description": "Optional notes about this deployment"
    },
    "rollback_sha": {
      "type": ["string", "null"],
      "pattern": "^[a-f0-9]{7,40}$",
      "description": "Git SHA to rollback to if needed"
    }
  }
}
